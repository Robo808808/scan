export ORACLE_SID=STBY
sqlplus / as sysdba
shutdown immediate;
startup nomount;

rman target sys@prim_tns auxiliary sys@stby_tns

RUN {
  DUPLICATE TARGET DATABASE
    FOR STANDBY FROM ACTIVE DATABASE
    DORECOVER
    SPFILE
      PARAMETER_VALUE_CONVERT 'PRIM','STBY'
      SET db_unique_name='STBY'
      SET log_archive_config='DG_CONFIG=(PRIM,STBY)'
      SET log_archive_dest_1='LOCATION=USE_DB_RECOVERY_FILE_DEST VALID_FOR=(ALL_LOGFILES,ALL_ROLES) DB_UNIQUE_NAME=STBY'
      SET log_archive_dest_2='SERVICE=prim_tns ASYNC NOAFFIRM VALID_FOR=(ONLINE_LOGFILES,PRIMARY_ROLE) DB_UNIQUE_NAME=PRIM'
      SET standby_file_management='AUTO'
      SET fal_client='STBY_TNS'
      SET fal_server='PRIM_TNS'
      SET remote_login_passwordfile='EXCLUSIVE';
    NOFILENAMECHECK;
}

sqlplus / as sysdba

-- Check
select database_role, open_mode from v$database;

-- Start redo apply
ALTER DATABASE RECOVER MANAGED STANDBY DATABASE USING CURRENT LOGFILE DISCONNECT FROM SESSION;

-- (Optional for Active Data Guard)
-- ALTER DATABASE OPEN READ ONLY;
-- ALTER DATABASE RECOVER MANAGED STANDBY DATABASE USING CURRENT LOGFILE DISCONNECT;

dgmgrl sys@prim_tns

-- If Broker still knows about STBY:
DGMGRL> reinstate database 'STBY';
-- If reinstate fails because itâ€™s too far behind:
DGMGRL> disable database 'STBY';
DGMGRL> remove database 'STBY';
DGMGRL> add database 'STBY' as connect identifier is 'stby_tns' maintained as physical;
DGMGRL> enable database 'STBY';
